"use strict";(()=>{var f={},I={};function u(s){if(f[s])return clearTimeout(I[s]),I[s]=setTimeout(()=>{delete f[s],delete I[s]},6e4),f[s];let t=[],e="";for(let n=0;n<s.length;n++){let i=s[n];/\s/.test(i)?e&&(t.push(e),e=""):/[.,!?;:()]/.test(i)?(e&&(t.push(e),e=""),t.push(i)):e+=i}return e&&t.push(e),f[s]=t.map(n=>v(n)).filter(n=>n.length>0),I[s]=setTimeout(()=>{delete f[s],delete I[s]},6e4),f[s]}function v(s){let t={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00F1:"n",\u00E4:"a",\u00F6:"o",\u00FC:"u"},e=["un","re","in","im","dis","en","non","non-","pre","pre-","mis","sub","inter","fore","de","trans","super","semi","anti","mid","under"],n=["s","es","ed","ing","ly","er","or","ion","tion","ation","ity","ment","ness","ful","less","est","ive","y","ize","ise","ify","en","ssa","lla","aa"];for(let i of e)if(s.startsWith(i)){s=s.replace(i,"");break}for(let i of n)if(s.endsWith(i)){s=s.replace(i,"");break}return s.toLowerCase().replace(/[áéíóúñäöü]/g,i=>t[i]||i)}function O(s,t){let e=new Set(s),n=new Set(t),i=new Set([...e].filter(r=>n.has(r))),o=new Set([...e,...n]);return i.size/o.size}function b(s,t){let e=new Set(s),n=new Set(t);return new Set([...n].filter(o=>e.has(o))).size/n.size}function p(s,t,e){let n=0;for(let o=0;o<=t.length-t.length;o++){let r=0;for(let a=0;a<=s.length-t.length;a++)if(s[a]===t[o]){let c=0,h=0,d=0;for(let l=-o;l<t.length-o;l++){let T=1-Math.abs(l)/t.length;d+=T,s[a+l]===t[o+l]&&(h+=T)}c=h/d,c>r&&(r=c)}n+=r}let i=n/t.length;return i>=e?i:0}function N(s,t=1){let e=0,n=(s.match(/—/g)||[]).length;e+=n*.3;let i=(s.match(/[\u{1F600}-\u{1F64F}]/gu)||[]).length;e+=i*.5;let o=["as an ai language model","i am an ai","i am an artificial intelligence","as an artificial intelligence"];for(let a of o){let c=(s.toLowerCase().match(new RegExp(a,"g"))||[]).length;e+=c*1}let r=(s.match(/\b\d+\./g)||[]).length;return e+=r*.05,e>t?1:0}var y={weights:{reasons:{KEEPS_SWITCHING_TABS_AND_COPY_PASTING:.3,COPY_RELATES_TO_PASTE:.3,CONTENT_CONTAINS_AI_SIGNATURES:.2,UNMODIFIED_PASTES:.1},min_copy_event_time_weight:.5,min_tab_event_time_weight:.5},paste_size_threshold:100,copy_size_threshold:30,settings:{relevant_copy_event_minutes:5,relevant_tab_in_out_event_minutes:5}},w={deadline:0,caught_rate:0,non_native_language:!1},A=class{constructor(t,e){this.isInitialized=!1;this.loadStateLoader=null;this.element=t,this.watchdog=e,this.state={COPY_PASTE_CONTRIBUTIONS:[],COPY_RELATES_TO_PASTE:0,CONTENT_CONTAINS_AI_SIGNATURES:0,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:0,UNMODIFIED_PASTES:0},this.handlePaste=this.handlePaste.bind(this)}setStateLoader(t){this.loadStateLoader=t}async initialize(){if(!this.watchdog.isMonitoring)throw new Error("Watchdog is not initialized. Please call scDetect.initialize() first.");this.isInitialized=!0;let t=this.element.tagName.toLowerCase(),e=this.element.type;if(t==="textarea"||t==="input"&&e==="text"||this.element.isContentEditable)await this.loadState(),this.restart();else throw new Error("Element is not a valid input field (textarea, input type=text, or contenteditable).")}async loadState(){this.loadStateLoader&&(this.state=await this.loadStateLoader())}getState(){return this.state}restart(){if(!this.isInitialized)throw new Error("WatchdogHandle is not initialized. Please call initialize() first.");this.element.removeEventListener("paste",this.handlePaste),this.element.removeEventListener("input",this.handleInput),this.element.addEventListener("paste",this.handlePaste),this.element.addEventListener("input",this.handleInput)}stop(){this.isInitialized=!1,this.element.removeEventListener("paste",this.handlePaste),this.element.removeEventListener("input",this.handleInput)}destroy(){this.stop(),this.watchdog.handles=this.watchdog.handles.filter(t=>t!==this)}handleInput(t){this.recalculateCopyRelatesToPaste(),this.recalculateAIScore(),this.recalculateUnmodifiedPastes(),this.recalculateKeepsSwitchingTabsAndCopyPasting()}handlePaste(t){let e=t.clipboardData;if(!e)return;let n=e.getData("text/plain");if(!n||n.length<this.watchdog.config.paste_size_threshold)return;let i=u(n),o=O(i,this.watchdog.lastCopiedInfo?this.watchdog.lastCopiedInfo.tokens:[]),r=b(this.watchdog.lastCopiedInfo?this.watchdog.lastCopiedInfo.tokens:[],i);if(o>.9)return;let a=new Date,c=!1,h=0,d=!1,l=0;if(this.watchdog.lastCopiedInfo){let m=a.getTime()-this.watchdog.lastCopiedInfo.timestamp.getTime();m<this.watchdog.config.settings.relevant_copy_event_minutes*60*1e3&&(c=!0,h=1-m/(this.watchdog.config.settings.relevant_copy_event_minutes*60*1e3),h<this.watchdog.config.weights.min_copy_event_time_weight&&(h=this.watchdog.config.weights.min_copy_event_time_weight))}if(this.watchdog.activeTabFocusInfo){let m=a.getTime()-this.watchdog.activeTabFocusInfo.focused_in.getTime();m<this.watchdog.config.settings.relevant_tab_in_out_event_minutes*60*1e3&&(d=!0,l=1-m/(this.watchdog.config.settings.relevant_tab_in_out_event_minutes*60*1e3),l<this.watchdog.config.weights.min_tab_event_time_weight&&(l=this.watchdog.config.weights.min_tab_event_time_weight))}let T=(c?1:0)*h,_=(d?1:0)*l,g=(r+T+_)/3,S=g,C=N(n,1);C>=g&&(S=C),this.state.COPY_PASTE_CONTRIBUTIONS.push({pasteScore:g,score:S,aiScore:C,timestamp:a,similarity:o,containment:r,copyFactor:T,tabSwitchFactor:_,content:n}),this.recalculateCopyRelatesToPaste(),this.recalculateAIScore(),this.recalculateUnmodifiedPastes(),this.recalculateKeepsSwitchingTabsAndCopyPasting()}recalculateCopyRelatesToPaste(){if(this.state.COPY_PASTE_CONTRIBUTIONS.length===0)this.state.COPY_RELATES_TO_PASTE=0;else{let t=0,e=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(n=>{let i=p(u(e),u(n.content),.7);t+=i*n.score}),this.state.COPY_RELATES_TO_PASTE=t/this.state.COPY_PASTE_CONTRIBUTIONS.length}}recalculateAIScore(){if(this.state.COPY_PASTE_CONTRIBUTIONS.length===0)this.state.CONTENT_CONTAINS_AI_SIGNATURES=0;else{let t=0,e=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(n=>{let i=p(u(e),u(n.content),.7);t+=i*n.aiScore}),this.state.CONTENT_CONTAINS_AI_SIGNATURES=t/this.state.COPY_PASTE_CONTRIBUTIONS.length}}recalculateUnmodifiedPastes(){let t=0,e=this.state.COPY_PASTE_CONTRIBUTIONS.length;if(e===0){this.state.UNMODIFIED_PASTES=0;return}let n=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(h=>{n.includes(h.content)&&(t++,n=n.replace(h.content,""))});let i=t/e,o=n.length,r=this.getContentFromHTMLElement().length,a=r>0?o/r:0,c=(i+(1-a))/2;this.state.UNMODIFIED_PASTES=c}recalculateKeepsSwitchingTabsAndCopyPasting(){let t=0,e=0,n=[...this.watchdog.tabFocusWatchInfoHistory,this.watchdog.activeTabFocusInfo];if(n.length<2){this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=0;return}let i=this.getContentFromHTMLElement(),o=u(i);for(let a=1;a<n.length;a++){let c=n[a],h=n[a+1],d=h&&h.focused_out?h.focused_out:new Date,l=c.focused_out?c.focused_out:c.focused_in,T=this.state.COPY_PASTE_CONTRIBUTIONS.filter(_=>_.timestamp>=l&&_.timestamp<=d);if(T.length>0){e++;let _=0;T.forEach(g=>{let S=0;S=p(o,u(g.content),.7)*g.score,S>_&&(_=S)}),t+=_}}if(e===0){this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=0;return}let r=t/e;this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=r}getCurrentAISignatureScore(){return N(this.getContentFromHTMLElement(),1)}getContentFromHTMLElement(){return this.element.tagName.toLowerCase()==="textarea"||this.element.tagName.toLowerCase()==="input"&&this.element.type==="text"?this.element.value:this.element.isContentEditable?this.element.innerText:""}getLastAnalysis(){let t={COPY_RELATES_TO_PASTE:this.state.COPY_RELATES_TO_PASTE*this.watchdog.config.weights.reasons.COPY_RELATES_TO_PASTE,CONTENT_CONTAINS_AI_SIGNATURES:this.state.CONTENT_CONTAINS_AI_SIGNATURES*this.watchdog.config.weights.reasons.CONTENT_CONTAINS_AI_SIGNATURES,UNMODIFIED_PASTES:this.state.UNMODIFIED_PASTES*this.watchdog.config.weights.reasons.UNMODIFIED_PASTES,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING*this.watchdog.config.weights.reasons.KEEPS_SWITCHING_TABS_AND_COPY_PASTING};return{raw:{COPY_RELATES_TO_PASTE:this.state.COPY_RELATES_TO_PASTE,CONTENT_CONTAINS_AI_SIGNATURES:this.state.CONTENT_CONTAINS_AI_SIGNATURES,UNMODIFIED_PASTES:this.state.UNMODIFIED_PASTES,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING},weighted:t,confidence:t.COPY_RELATES_TO_PASTE+t.CONTENT_CONTAINS_AI_SIGNATURES+t.UNMODIFIED_PASTES+t.KEEPS_SWITCHING_TABS_AND_COPY_PASTING}}},P=class{constructor(){this.isMonitoring=!1;this.handles=[];this.userId=null;this.tabFocusWatchInfoHistory=[];this.activeTabFocusInfo=null;this.lastCopiedInfo=null;this.copyInfo10History=[];this.config=y,this.factors=w,this.userId=null,this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleCopy=this.handleCopy.bind(this)}query(t){let e=typeof t=="string"?document.querySelectorAll(t):[t];if(e.length!==1)throw new Error(`Expected one element for selector "${t}", but found ${e.length}.`);let n=new A(e[0],this);return this.handles.push(n),n}queryAll(t){(typeof t=="string"?document.querySelectorAll(t):t).forEach(n=>{let i=new A(n,this);return this.handles.push(i),i})}initialize(t,e,n){this.config={...y,...e},this.factors={...w,...n},this.userId=t,this.isMonitoring||this.beginMonitoring()}stop(){this.isMonitoring=!1,this.handles.forEach(t=>t.stop()),document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("copy",this.handleCopy)}changeUser(t){this.userId=t,this.stop(),this.handles.forEach(e=>e.loadState()),this.beginMonitoring()}beginMonitoring(){this.isMonitoring=!0,this.activeTabFocusInfo={focused_in:new Date,gap_ms:0,is_focused:!0},this.tabFocusWatchInfoHistory=[],this.lastCopiedInfo=null,this.copyInfo10History=[],document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("copy",this.handleCopy),this.handles.forEach(t=>{t.isInitialized&&t.restart()})}handleVisibilityChange(){if(document.hidden&&this.activeTabFocusInfo)this.activeTabFocusInfo.focused_out=new Date,this.activeTabFocusInfo.duration_ms=this.activeTabFocusInfo.focused_out.getTime()-this.activeTabFocusInfo.focused_in.getTime(),this.activeTabFocusInfo.is_focused=!1,this.tabFocusWatchInfoHistory.push(this.activeTabFocusInfo),this.activeTabFocusInfo=null;else{let t=this.tabFocusWatchInfoHistory.length>0?this.tabFocusWatchInfoHistory[this.tabFocusWatchInfoHistory.length-1]:null,e=t&&t.focused_out?new Date().getTime()-t.focused_out.getTime():0;this.activeTabFocusInfo={focused_in:new Date,gap_ms:e,is_focused:!0}}}handleCopy(t){let e=t.clipboardData;if(e){let n=e.getData("text/plain"),i=n.length;if(i<this.config.copy_size_threshold)return;this.lastCopiedInfo={timestamp:new Date,content:n,tokens:u(n),size:i},this.copyInfo10History.push(this.lastCopiedInfo),this.copyInfo10History.length>10&&this.copyInfo10History.shift()}}},F=new P,E=F;var D={query:E.query,initialize:E.initialize,stop:E.stop,queryAll:E.queryAll,version:"1.0.0"},G=D;})();
//# sourceMappingURL=sc-detect.min.js.map
