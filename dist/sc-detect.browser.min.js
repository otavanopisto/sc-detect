"use strict";(()=>{var f={},m={};function g(i){if(f[i])return clearTimeout(m[i]),m[i]=setTimeout(()=>{delete f[i],delete m[i]},6e4),f[i];let t=[],e="";for(let n=0;n<i.length;n++){let s=i[n];/\s/.test(s)?e&&(t.push(e),e=""):/[.,!?;:()]/.test(s)?(e&&(t.push(e),e=""),t.push(s)):e+=s}return e&&t.push(e),f[i]=t.map(n=>w(n)).filter(n=>n.length>0),m[i]=setTimeout(()=>{delete f[i],delete m[i]},6e4),f[i]}function w(i){let t={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00F1:"n",\u00E4:"a",\u00F6:"o",\u00FC:"u"},e=["un","re","in","im","dis","en","non","non-","pre","pre-","mis","sub","inter","fore","de","trans","super","semi","anti","mid","under"],n=["s","es","ed","ing","ly","er","or","ion","tion","ation","ity","ment","ness","ful","less","est","ive","y","ize","ise","ify","en","ssa","lla","aa"];for(let s of e)if(i.startsWith(s)){i=i.replace(s,"");break}for(let s of n)if(i.endsWith(s)){i=i.replace(s,"");break}return i.toLowerCase().replace(/[áéíóúñäöü]/g,s=>t[s]||s)}function N(i,t){let e=new Set(i),n=new Set(t),s=new Set([...e].filter(a=>n.has(a))),o=new Set([...e,...n]);return s.size/o.size}function P(i,t){let e=new Set(i),n=new Set(t);return new Set([...n].filter(o=>e.has(o))).size/n.size}function E(i,t,e){let n=0;for(let o=0;o<t.length;o++){let a=0;for(let r=0;r<i.length;r++)if(i[r]===t[o]){let h=0,c=0,u=0;for(let _=-o;_<t.length-o;_++){let l=1-Math.abs(_)/t.length;u+=l,i[r+_]===t[o+_]&&(c+=l)}h=c/u,h>a&&(a=h)}n+=a}let s=n/t.length;return s>=e?s:0}function A(i,t=1){let e=0,n=(i.match(/—/g)||[]).length;e+=n*.3;let s=(i.match(/\*\*/g)||[]).length;e+=s*.15;let o=(i.match(/(?:\p{Emoji_Presentation}|\p{Emoji}\uFE0F)(?:\u200D(?:\p{Emoji_Presentation}|\p{Emoji}\uFE0F))*|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}/gu)||[]).length;e+=o*.5;let a=["as an ai language model","i am an ai","i am an artificial intelligence","as an artificial intelligence","chatgpt","gemini","claude"];for(let h of a){let c=(i.toLowerCase().match(new RegExp(h,"g"))||[]).length;e+=c*1}let r=(i.match(/\b\d+\./g)||[]).length;return e+=r*.05,e>t?1:0}var O={weights:{reasons:{KEEPS_SWITCHING_TABS_AND_COPY_PASTING:.3,COPY_RELATES_TO_PASTE:.3,CONTENT_CONTAINS_AI_SIGNATURES:.2,UNMODIFIED_PASTES:.1},min_copy_event_time_weight:.5,min_tab_event_time_weight:.5},paste_size_threshold:30,copy_size_threshold:30,settings:{relevant_copy_event_minutes:5,relevant_tab_in_out_event_minutes:5}},b={deadline:0,caught_rate:0,non_native_language:!1},C=class{constructor(t,e){this.isInitialized=!1;this.loadStateLoader=null;this.listeners=[];this.element=t,this.watchdog=e,this.state={COPY_PASTE_CONTRIBUTIONS:[],COPY_RELATES_TO_PASTE:0,CONTENT_CONTAINS_AI_SIGNATURES:0,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:0,UNMODIFIED_PASTES:0},this.handlePaste=this.handlePaste.bind(this),this.handleInput=this.handleInput.bind(this)}setStateLoader(t){this.loadStateLoader=t}async initialize(){if(!this.watchdog.isMonitoring)throw new Error("Watchdog is not initialized. Please call scDetect.initialize() first.");this.isInitialized=!0;let t=this.element.tagName.toLowerCase(),e=this.element.type;if(t==="textarea"||t==="input"&&e==="text"||this.element.isContentEditable)await this.loadState(),this.restart();else throw new Error("Element is not a valid input field (textarea, input type=text, or contenteditable).")}async loadState(){this.loadStateLoader&&(this.state=await this.loadStateLoader()),this.recalculateCopyRelatesToPaste(),this.recalculateAIScore(),this.recalculateUnmodifiedPastes(),this.recalculateKeepsSwitchingTabsAndCopyPasting(),this.onNewScoreCalculated()}getState(){return this.state}restart(){if(!this.isInitialized)throw new Error("WatchdogHandle is not initialized. Please call initialize() first.");this.element.removeEventListener("paste",this.handlePaste),this.element.removeEventListener("input",this.handleInput),this.element.addEventListener("paste",this.handlePaste),this.element.addEventListener("input",this.handleInput)}stop(){this.isInitialized=!1,this.element.removeEventListener("paste",this.handlePaste),this.element.removeEventListener("input",this.handleInput)}destroy(){this.stop(),this.watchdog.handles=this.watchdog.handles.filter(t=>t!==this)}handleInput(t){this.recalculateCopyRelatesToPaste(),this.recalculateAIScore(),this.recalculateUnmodifiedPastes(),this.recalculateKeepsSwitchingTabsAndCopyPasting(),this.onNewScoreCalculated()}handlePaste(t){let e=t.clipboardData;if(!e)return;let n=e.getData("text/plain");n&&(n.length<this.watchdog.config.paste_size_threshold||this.handlePastedText(n))}handlePastedText(t){let e=g(t),n=N(e,this.watchdog.lastCopiedInfo?this.watchdog.lastCopiedInfo.tokens:[]),s=this.watchdog.lastCopiedInfo?.tokens.length?P(e,this.watchdog.lastCopiedInfo?this.watchdog.lastCopiedInfo.tokens:[]):0;if(n>.9)return;let o=new Date,a=!1,r=0,h=!1,c=0;if(this.watchdog.lastCopiedInfo){let T=o.getTime()-this.watchdog.lastCopiedInfo.timestamp.getTime();T<this.watchdog.config.settings.relevant_copy_event_minutes*60*1e3&&(a=!0,r=1-T/(this.watchdog.config.settings.relevant_copy_event_minutes*60*1e3),r<this.watchdog.config.weights.min_copy_event_time_weight&&(r=this.watchdog.config.weights.min_copy_event_time_weight))}if(this.watchdog.activeTabFocusInfo){let T=o.getTime()-this.watchdog.activeTabFocusInfo.focused_in.getTime();T<this.watchdog.config.settings.relevant_tab_in_out_event_minutes*60*1e3&&(h=!0,c=1-T/(this.watchdog.config.settings.relevant_tab_in_out_event_minutes*60*1e3),c<this.watchdog.config.weights.min_tab_event_time_weight&&(c=this.watchdog.config.weights.min_tab_event_time_weight))}let u=(a?1:0)*r,_=(h?1:0)*c,l=s*u*_,d=l,S=A(t,1);S>=l&&(d*=S),this.state.COPY_PASTE_CONTRIBUTIONS.push({pasteScore:l,score:d,aiScore:S,timestamp:o,similarity:n,containment:s,copyFactor:u,tabSwitchFactor:_,content:t})}recalculateCopyRelatesToPaste(){if(this.state.COPY_PASTE_CONTRIBUTIONS.length===0)this.state.COPY_RELATES_TO_PASTE=0;else{let t=0,e=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(n=>{let s=E(g(e),g(n.content),.7);t+=s*n.score}),this.state.COPY_RELATES_TO_PASTE=t/this.state.COPY_PASTE_CONTRIBUTIONS.length}}recalculateAIScore(){if(this.state.COPY_PASTE_CONTRIBUTIONS.length===0)this.state.CONTENT_CONTAINS_AI_SIGNATURES=0;else{let t=0,e=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(n=>{let s=E(g(e),g(n.content),.7);t+=s*n.aiScore}),this.state.CONTENT_CONTAINS_AI_SIGNATURES=t/this.state.COPY_PASTE_CONTRIBUTIONS.length}}recalculateUnmodifiedPastes(){let t=0,e=this.state.COPY_PASTE_CONTRIBUTIONS.length;if(e===0){this.state.UNMODIFIED_PASTES=0;return}let n=this.getContentFromHTMLElement();this.state.COPY_PASTE_CONTRIBUTIONS.forEach(c=>{if(n.includes(c.content))t++,n=n.replace(c.content,"");else{let u=c.content.split(/(?<=[.!?])\s+|\n|\r\n/).filter(l=>l.trim().length>0),_=0;for(let l of u)n.includes(l)&&(_++,n=n.replace(l,""));t+=_/u.length}});let s=t/e,o=n.length,a=this.getContentFromHTMLElement().length,r=a>0?o/a:0,h=(s+(1-r))/2;this.state.UNMODIFIED_PASTES=h}recalculateKeepsSwitchingTabsAndCopyPasting(){let t=0,e=0,n=[...this.watchdog.tabFocusWatchInfoHistory,this.watchdog.activeTabFocusInfo];if(n.length<2){this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=0;return}let s=this.getContentFromHTMLElement(),o=g(s);for(let r=1;r<n.length;r++){let h=n[r],c=n[r+1],u=c&&c.focused_out?c.focused_out:new Date,_=h.focused_out?h.focused_out:h.focused_in,l=this.state.COPY_PASTE_CONTRIBUTIONS.filter(d=>d.timestamp>=_&&d.timestamp<=u);if(l.length>0){e++;let d=0;l.forEach(S=>{let T=0;T=E(o,g(S.content),.7)*S.score,T>d&&(d=T)}),t+=d}}if(e===0){this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=0;return}let a=t/e;this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING=a}getCurrentAISignatureScore(){return A(this.getContentFromHTMLElement(),1)}getContentFromHTMLElement(){return this.element.tagName.toLowerCase()==="textarea"||this.element.tagName.toLowerCase()==="input"&&this.element.type==="text"?this.element.value:this.element.isContentEditable?this.element.innerText:""}getLastAnalysis(){let t={COPY_RELATES_TO_PASTE:this.state.COPY_RELATES_TO_PASTE*this.watchdog.config.weights.reasons.COPY_RELATES_TO_PASTE,CONTENT_CONTAINS_AI_SIGNATURES:this.state.CONTENT_CONTAINS_AI_SIGNATURES*this.watchdog.config.weights.reasons.CONTENT_CONTAINS_AI_SIGNATURES,UNMODIFIED_PASTES:this.state.UNMODIFIED_PASTES*this.watchdog.config.weights.reasons.UNMODIFIED_PASTES,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING*this.watchdog.config.weights.reasons.KEEPS_SWITCHING_TABS_AND_COPY_PASTING};return{raw:{COPY_RELATES_TO_PASTE:this.state.COPY_RELATES_TO_PASTE,CONTENT_CONTAINS_AI_SIGNATURES:this.state.CONTENT_CONTAINS_AI_SIGNATURES,UNMODIFIED_PASTES:this.state.UNMODIFIED_PASTES,KEEPS_SWITCHING_TABS_AND_COPY_PASTING:this.state.KEEPS_SWITCHING_TABS_AND_COPY_PASTING},weighted:t,confidence:t.COPY_RELATES_TO_PASTE+t.CONTENT_CONTAINS_AI_SIGNATURES+t.UNMODIFIED_PASTES+t.KEEPS_SWITCHING_TABS_AND_COPY_PASTING}}onNewScoreCalculated(){let t=this.getLastAnalysis();this.listeners.forEach(e=>{e(t)})}addEventListenerOnNewScoreCalculated(t){this.listeners.push(t)}removeEventListenerOnNewScoreCalculated(t){this.listeners=this.listeners.filter(e=>e!==t)}},p=class{constructor(){this.isMonitoring=!1;this.handles=[];this.userId=null;this.tabFocusWatchInfoHistory=[];this.activeTabFocusInfo=null;this.lastCopiedInfo=null;this.copyInfo10History=[];this.config=O,this.factors=b,this.userId=null,this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleCopy=this.handleCopy.bind(this),this.query=this.query.bind(this),this.queryAll=this.queryAll.bind(this),this.initialize=this.initialize.bind(this),this.stop=this.stop.bind(this),this.changeUser=this.changeUser.bind(this),this.beginMonitoring=this.beginMonitoring.bind(this)}query(t){let e=typeof t=="string"?document.querySelectorAll(t):[t];if(e.length!==1)throw new Error(`Expected one element for selector "${t}", but found ${e.length}.`);let n=new C(e[0],this);return this.handles.push(n),n}queryAll(t){let e=typeof t=="string"?document.querySelectorAll(t):t;return Array.from(e).map(n=>{let s=new C(n,this);return this.handles.push(s),s})}initialize(t,e,n){this.config={...O,...e},this.factors={...b,...n},this.userId=t,this.isMonitoring||this.beginMonitoring()}stop(){this.isMonitoring=!1,this.handles.forEach(t=>t.stop()),document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("copy",this.handleCopy)}changeUser(t){this.userId=t,this.stop(),this.handles.forEach(e=>e.loadState()),this.beginMonitoring()}beginMonitoring(){this.isMonitoring=!0,this.activeTabFocusInfo={focused_in:new Date,gap_ms:0,is_focused:!0},this.tabFocusWatchInfoHistory=[],this.lastCopiedInfo=null,this.copyInfo10History=[],document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("copy",this.handleCopy),this.handles.forEach(t=>{t.isInitialized&&t.restart()})}handleVisibilityChange(){if(document.hidden&&this.activeTabFocusInfo)this.activeTabFocusInfo.focused_out=new Date,this.activeTabFocusInfo.duration_ms=this.activeTabFocusInfo.focused_out.getTime()-this.activeTabFocusInfo.focused_in.getTime(),this.activeTabFocusInfo.is_focused=!1,this.tabFocusWatchInfoHistory.push(this.activeTabFocusInfo),this.activeTabFocusInfo=null;else{let t=this.tabFocusWatchInfoHistory.length>0?this.tabFocusWatchInfoHistory[this.tabFocusWatchInfoHistory.length-1]:null,e=t&&t.focused_out?new Date().getTime()-t.focused_out.getTime():0;this.activeTabFocusInfo={focused_in:new Date,gap_ms:e,is_focused:!0}}}handleCopy(t){let e=t.clipboardData;if(e){let n=e.getData("text/plain"),s=window.getSelection()?.toString()||"",o=n||s;if(!o)return;let a=o.length;if(a<this.config.copy_size_threshold)return;this.lastCopiedInfo={timestamp:new Date,content:o,tokens:g(o),size:a},this.copyInfo10History.push(this.lastCopiedInfo),this.copyInfo10History.length>10&&this.copyInfo10History.shift()}}},v=new p,I=v;var y={query:I.query,initialize:I.initialize,stop:I.stop,queryAll:I.queryAll,version:"1.0.0"};typeof window<"u"&&(window.scDetect=y);var M=y;})();
